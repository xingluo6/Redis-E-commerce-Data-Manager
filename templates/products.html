{% extends "base.html" %}

{% block title %}商品列表{% endblock %}

{% block content %}
<h2>商品列表</h2>

<div class="row mb-3">
    <div class="col-md-6">
        <form class="d-flex" action="{{ url_for('list_products') }}" method="get">
            <input class="form-control me-2" type="search" placeholder="搜索商品名称/描述/分类..." aria-label="Search" name="search_query" value="{{ search_query }}">
            <input type="hidden" name="page_size" value="{{ page_size }}">
            <button class="btn btn-outline-success" type="submit">搜索</button>
        </form>
    </div>
    <div class="col-md-6 text-end">
        <a href="{{ url_for('add_product') }}" class="btn btn-primary">添加商品</a>
    </div>
</div>

{% if error %}
    <div class="alert alert-danger">{{ error }}</div>
{% elif products %}
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>ID</th>
            <th>名称</th>
            <th>分类</th>
            <th>价格</th>
            <th>库存</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody>
        {% for product in products %}
        <tr>
            <td>{{ product.product_id[:8] }}...</td>
            <td>{{ product.name }}</td>
            <td>{{ product.category }}</td>
            <td>{{ "%.2f" | format(product.price) }}</td>
            <td>{{ product.stock }}</td>
            <td>
                <a href="{{ url_for('product_detail', product_id=product.product_id) }}" class="btn btn-info btn-sm">查看</a>
                <a href="{{ url_for('edit_product', product_id=product.product_id) }}" class="btn btn-warning btn-sm">编辑</a>
                <form action="{{ url_for('delete_product', product_id=product.product_id) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('您确定要删除商品 {{ product.name }} 吗？此操作不可逆！');">删除</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- 分页控件 -->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('list_products', page=current_page-1, page_size=page_size, search_query=search_query) }}">上一页</a>
        </li>
        <!-- 页码下拉框 -->
        <li class="page-item">
            <select class="form-select" onchange="window.location.href = this.value;">
                {% for p in range(1, total_pages + 1) %}
                    <option value="{{ url_for('list_products', page=p, page_size=page_size, search_query=search_query) }}" {% if p == current_page %}selected{% endif %}>
                        {{ p }} / {{ total_pages }}
                    </option>
                {% endfor %}
            </select>
        </li>
        <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('list_products', page=current_page+1, page_size=page_size, search_query=search_query) }}">下一页</a>
        </li>
    </ul>
</nav>

{% else %}
    <p>没有商品数据。请前往 <a href="{{ url_for('data_management') }}">数据管理</a> 页面生成数据。</p>
{% endif %}
{% endblock %}