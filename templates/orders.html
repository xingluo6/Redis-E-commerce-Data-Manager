{% extends "base.html" %}

{% block title %}订单列表{% endblock %}

{% block content %}
<h2>订单列表</h2>

<div class="row mb-3">
    <div class="col-md-6">
        <form class="d-flex" action="{{ url_for('list_orders') }}" method="get">
            <input class="form-control me-2" type="search" placeholder="搜索订单ID/用户ID/国家/状态..." aria-label="Search" name="search_query" value="{{ search_query }}">
            <input type="hidden" name="page_size" value="{{ page_size }}">
            <button class="btn btn-outline-success" type="submit">搜索</button>
        </form>
    </div>
    <div class="col-md-6 text-end">
        <!-- 订单通常不由用户直接添加，所以没有“添加订单”按钮 -->
    </div>
</div>

{% if error %}
    <div class="alert alert-danger">{{ error }}</div>
{% elif orders %}
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>订单ID</th>
            <th>用户ID</th>
            <th>总金额</th>
            <th>国家</th>
            <th>订单日期</th>
            <th>状态</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody>
        {% for order in orders %}
        <tr>
            <td>{{ order.order_id[:8] }}...</td>
            <td>{{ order.user_id[:8] }}...</td>
            <td>{{ "%.2f" | format(order.total_amount) }}</td>
            <td>{{ order.country }}</td>
            <td>{{ order.order_date }}</td>
            <td>{{ order.status }}</td>
            <td>
                <a href="{{ url_for('order_detail', order_id=order.order_id) }}" class="btn btn-info btn-sm">查看</a>
                <a href="{{ url_for('edit_order_status', order_id=order.order_id) }}" class="btn btn-warning btn-sm">编辑状态</a>
                <form action="{{ url_for('delete_order', order_id=order.order_id) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('您确定要删除订单 {{ order.order_id[:8] }}... 吗？此操作不可逆！');">删除</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- 分页控件 -->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('list_orders', page=current_page-1, page_size=page_size, search_query=search_query) }}">上一页</a>
        </li>
        <!-- 页码下拉框 -->
        <li class="page-item">
            <select class="form-select" onchange="window.location.href = this.value;">
                {% for p in range(1, total_pages + 1) %}
                    <option value="{{ url_for('list_orders', page=p, page_size=page_size, search_query=search_query) }}" {% if p == current_page %}selected{% endif %}>
                        {{ p }} / {{ total_pages }}
                    </option>
                {% endfor %}
            </select>
        </li>
        <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('list_orders', page=current_page+1, page_size=page_size, search_query=search_query) }}">下一页</a>
        </li>
    </ul>
</nav>

{% else %}
    <p>没有订单数据。请前往 <a href="{{ url_for('data_management') }}">数据管理</a> 页面生成数据。</p>
{% endif %}
{% endblock %}